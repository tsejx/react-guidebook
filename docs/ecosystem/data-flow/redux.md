---
nav:
  title: ç”Ÿæ€
  order: 3
group:
  title: æ•°æ®æµ
  order: 3
title: Redux
order: 2
---

# Redux

> Redux is a predictable state container for JavaScript apps
>
> Redux æ˜¯é’ˆå¯¹ JavaScript åº”ç”¨çš„å¯é¢„æµ‹çŠ¶æ€å®¹å™¨

Redux æ˜¯ä¸€ä¸ª **æ•°æ®ç®¡ç†ä¸­å¿ƒ**ï¼Œæä¾› **å¯é¢„æµ‹åŒ–** çš„çŠ¶æ€ç®¡ç†ï¼Œå¯ä»¥è®©ä½ æ„å»ºä¸€è‡´åŒ–çš„åº”ç”¨ï¼Œè¿è¡Œäºä¸åŒçš„ç¯å¢ƒï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ã€åŸç”Ÿåº”ç”¨ï¼‰ï¼Œå¹¶ä¸”æ˜“äºæµ‹è¯•ã€‚

Redux å‚è€ƒäº† Flux çš„æ¶æ„æ€æƒ³ï¼Œå¯¹ Flux ä¸­å†—ä½™éƒ¨åˆ†ï¼ˆå¦‚ Dispatcherï¼‰è¿›è¡Œç®€åŒ–ï¼ŒåŒæ—¶å°† Elm è¯­è¨€ä¸­ **å‡½æ•°å¼ç¼–ç¨‹** çš„æ€æƒ³èå…¥å…¶ä¸­ã€‚

```jsx | inline
import React from 'react'
import img from '../../assets/redux-model.jpg'

export default () => <img alt="redux-model" src={img} width={520} />
```

<br/>

**Redux çš„ç‰¹ç‚¹ï¼š**

- **å¯é¢„æµ‹çš„ï¼ˆPredictableï¼‰**ï¼šå› ä¸º Redux ç”¨äº†çº¯å‡½æ•°ï¼ˆPure Functionï¼‰çš„æ¦‚å¿µï¼Œæ¯ä¸ªæ–°çš„ State éƒ½ä¼šç”±æ—§çš„ State åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ Stateï¼Œè¿™æ ·å¯ä»¥ä½œæ‰€è°“çš„æ—¶å…‰æ—…è¡Œè°ƒè¯•
- **çŠ¶æ€å®¹å™¨ï¼ˆState Containerï¼‰**ï¼šState æ˜¯é›†ä¸­åœ¨å•ä¸€ä¸ªå¯¹è±¡æ ‘çŠ¶ç»“æ„ä¸‹çš„å•ä¸€ Storeï¼ŒStore å³æ˜¯åº”ç”¨ç¨‹åºé¢†åŸŸï¼ˆApp Domainï¼‰çš„çŠ¶æ€é›†åˆ
- **JavaScript åº”ç”¨**ï¼šè¿™è¯´æ˜ Redux å¹¶éå•æŒ‡è®¾è®¡ç»™ React ä½¿ç”¨çš„ï¼Œå®ƒæ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªå‡½æ•°åº“ï¼Œå¯é€šç”¨äºå„ç§åŠŸèƒ½ JavaScript åº”ç”¨

é€šè¿‡ä¸€å¼ å›¾çœ‹ Redux å¦‚ä½•ç®€åŒ–çŠ¶æ€ç®¡ç†ã€‚

```jsx | inline
import React from 'react'
import img from '../../assets/redux_1.jpg'

export default () => <img alt="Redux State" src={img} width={640} />
```

## ä¸‰å¤§åŸåˆ™

- **å•ä¸€æ•°æ®æº**ï¼šæ•´ä¸ªåº”ç”¨åªæœ‰å”¯ä¸€çš„çŠ¶æ€æ ‘ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çŠ¶æ€ï¼ˆStateï¼‰æœ€ç»ˆç»´æŠ¤åœ¨ä¸€ä¸ªæ ¹çº§ Store ä¸­
- **çŠ¶æ€åªè¯»**ï¼šä¸ºäº†ä¿è¯çŠ¶æ€çš„ **å¯æ§æ€§**ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯ç›‘æ§çŠ¶æ€çš„å˜åŒ–
  - Redux Store ä¸­çš„æ•°æ®æ— æ³•è¢«ç›´æ¥ä¿®æ”¹
  - ä¸¥æ ¼æ§åˆ¶ä¿®æ”¹çš„æ‰§è¡Œã€‚
- **çº¯å‡½æ•°**ï¼šè§„å®šåªèƒ½é€šè¿‡ä¸€ä¸ªçº¯å‡½æ•°ï¼ˆReducerï¼‰æ¥æè¿°ä¿®æ”¹

### å•ä¸€æ•°æ®æº

**æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€æ•°æ®è¢«å‚¨å­˜åœ¨ä¸€æ£µ Object Tree ä¸­ï¼Œå¹¶ä¸”åªå­˜åœ¨äºå”¯ä¸€ä¸€ä¸ª Store ä¸­ã€‚**

åœ¨ä¼ ç»Ÿçš„ MVC æ¶æ„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ— æ•°ä¸ª Modelï¼Œè€Œ Model ä¹‹é—´å¯ä»¥äº’ç›¸ç›‘å¬ã€ è§¦å‘äº‹ä»¶ç”šè‡³å¾ªç¯æˆ–åµŒå¥—è§¦å‘äº‹ä»¶ï¼Œè¿™äº›åœ¨ Redux ä¸­éƒ½æ˜¯ä¸å…è®¸çš„ã€‚

å› ä¸ºåœ¨ Redux çš„æ€æƒ³é‡Œï¼Œä¸€ä¸ªåº”ç”¨æ°¸è¿œåªæœ‰å”¯ä¸€çš„æ•°æ®æºã€‚æˆ‘ä»¬çš„ç¬¬ä¸€ååº”å¯èƒ½æ˜¯ï¼šå¦‚æœæœ‰ä¸€ä¸ªå¤æ‚åº”ç”¨ï¼Œå¼ºåˆ¶è¦æ±‚å”¯ä¸€çš„æ•°æ®æºå²‚ä¸æ˜¯ä¼šäº§ç”Ÿä¸€ä¸ªç‰¹åˆ«åºå¤§çš„ JavaScript å¯¹è±¡ã€‚

å®é™…ä¸Šï¼Œä½¿ç”¨å•ä¸€æ•°æ®æºçš„å¥½å¤„åœ¨äºæ•´ä¸ªåº”ç”¨çŠ¶æ€éƒ½ä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬éšæ—¶å¯ä»¥æå–å‡ºæ•´ä¸ªåº”ç”¨çš„çŠ¶æ€è¿›è¡ŒæŒä¹…åŒ–ï¼ˆæ¯”å¦‚å®ç°ä¸€ä¸ªé’ˆå¯¹æ•´ä¸ªåº”ç”¨çš„å³æ—¶ä¿å­˜åŠŸèƒ½ï¼‰ã€‚æ­¤å¤–ï¼Œè¿™æ ·çš„è®¾è®¡ä¹Ÿä¸ºæœåŠ¡ç«¯æ¸²æŸ“æä¾›äº†å¯èƒ½ã€‚

è‡³äºæˆ‘ä»¬æ‹…å¿ƒçš„æ•°æ®æºå¯¹è±¡è¿‡äºåºå¤§çš„é—®é¢˜ï¼Œå¯é€šè¿‡äº†è§£ Redux æä¾›çš„å·¥å…·å‡½æ•° `combineReducers` æ˜¯å¦‚ä½•åŒ–è§£çš„ã€‚

> ğŸ“Œ Flux å¯èƒ½æœ‰å¤šä¸ª Storeï¼ˆåŒºåˆ«äº Flux çš„ Storeï¼ŒRedux çš„ State ä¸ä¼šå­˜æ”¾é€»è¾‘ï¼Œæ“ä½œæ•°æ®åœ¨ Reducer ä¸­å¤„ç†ï¼‰

### çŠ¶æ€åªè¯»

**åªèƒ½é€šè¿‡è§¦å‘äº‹ä»¶ï¼ˆä¹Ÿå°±æ˜¯è§¦å‘ Actionï¼‰æ¥äº§ç”Ÿæ–°çš„çŠ¶æ€æ•°æ®ï¼ŒAction æ˜¯ä¸€ä¸ªç”¨äºæè¿°å·²å‘ç”Ÿäº‹ä»¶çš„æ™®é€šå¯¹è±¡ã€‚**

è¿™ä¸€ç‚¹å’Œ Flux çš„æ€æƒ³ä¸è°‹è€Œåˆï¼Œä¸åŒçš„æ˜¯åœ¨ Flux ä¸­ï¼Œå› ä¸º Store æ²¡æœ‰ `setter` è€Œé™åˆ¶äº†æˆ‘ä»¬ç›´æ¥ä¿®æ”¹åº”ç”¨çŠ¶æ€çš„èƒ½åŠ›ï¼Œè€Œåœ¨ Redux ä¸­ï¼Œè¿™æ ·çš„é™åˆ¶è¢«æ‰§è¡Œå¾—æ›´åŠ å½»åº•ï¼Œå› ä¸ºæˆ‘ä»¬å‹æ ¹æ²¡æœ‰ Storeã€‚

åœ¨ Redux ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šè‡ªå·±ç”¨ä»£ç æ¥å®šä¹‰ä¸€ä¸ª Storeã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Reducerï¼Œ å®ƒçš„åŠŸèƒ½æ˜¯æ ¹æ®å½“å‰è§¦å‘çš„ Action å¯¹å½“å‰åº”ç”¨çš„ State è¿›è¡Œè¿­ä»£ï¼Œè¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç›´æ¥ä¿®æ”¹åº”ç”¨çš„ Stateï¼Œè€Œæ˜¯è¿”å›äº†ä¸€ä»½å…¨æ–°çš„çŠ¶æ€ã€‚

Redux æä¾›çš„ `createStore` æ–¹æ³•ä¼šæ ¹æ® Reducer ç”Ÿæˆ Storeã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ `store.dispatch` æ–¹æ³•æ¥è¾¾åˆ°ä¿®æ”¹çŠ¶æ€çš„ç›®çš„ã€‚

```js
store.dispatch({
  type: 'COMPLETE_TODO',
  index: 1,
});

store.dispatch({
  type: 'SET_VISIBILITY_FILTER',
  filter: 'SHOW_COMPELETED',
});
```

### çº¯å‡½æ•°

**åœ¨ Reducer ä¸­æŒ‡å®šçŠ¶æ€æ•°æ®è½¬æ¢çš„é€»è¾‘ã€‚**

**çº¯å‡½æ•°çš„ç‰¹ç‚¹ï¼š**

1. ç›¸åŒçš„è¾“å…¥ï¼Œç»“æœå§‹ç»ˆç›¸åŒ
2. ä¸å¯¹å¤–éƒ¨ç¯å¢ƒè¿›è¡Œæ“ä½œ

åœ¨ Redux é‡Œï¼Œæˆ‘ä»¬é€šè¿‡å®šä¹‰ Reducer æ¥ç¡®å®šçŠ¶æ€çš„ä¿®æ”¹ï¼Œè€Œæ¯ä¸€ä¸ª Reducer éƒ½æ˜¯çº¯å‡½æ•°ï¼Œè¿™æ„å‘³ç€å®ƒæ²¡æœ‰å‰¯ä½œç”¨ï¼Œå³æ¥å—ä¸€å®šçš„è¾“å…¥ï¼Œå¿…å®šä¼šå¾—åˆ°ä¸€å®šçš„è¾“å‡ºã€‚

è¿™æ ·è®¾è®¡çš„å¥½å¤„ä¸ä»…åœ¨äº Reducer é‡Œå¯¹çŠ¶æ€çš„ä¿®æ”¹å˜å¾—ç®€å•ã€çº¯ç²¹ã€å¯æµ‹è¯•ï¼Œæ›´æœ‰æ„æ€çš„æ˜¯ï¼Œ Redux åˆ©ç”¨æ¯æ¬¡æ–°è¿”å›çš„çŠ¶æ€ç”Ÿæˆé…·ç‚«çš„æ—¶é—´æ—…è¡Œï¼ˆtime travelï¼‰è°ƒè¯•æ–¹å¼ï¼Œè®©è·Ÿè¸ªæ¯ä¸€æ¬¡å› ä¸ºè§¦å‘ Action è€Œæ”¹å˜çŠ¶æ€çš„ç»“æœæˆä¸ºäº†å¯èƒ½ã€‚

```js
function visibilityFilter(state = 'SHOW_ALL', action) {
  switch(action.type) {
    case 'SET_VISIBILITY_FILTER'
        return action.filter
    default
        return state
  }
}

function todos(state = [], action) {
  switch(action.type) {
    case 'ADD_TODO':
      return [
        ...state,
        {
            text: action.text,
            completed: false
        }
      ]
    case 'COMPLTE_TODO':
      return state.map((todo, index) => {
        if (index === action.index) {
          return Object.assign({}, todo, {
            completed: true
          })
        }
        return todo
      })
    default:
      return state
  }
}

import { combineReducers, createStore } from 'redux'
let reducer = combineReducers({ visibilityFilter: todos })
let store = createStore(reducer)
```

> ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨çº¯å‡½æ•°ï¼Ÿ

å› ä¸º Redux çš„ Store è®¾è®¡ï¼Œå¹¶ä¸æ˜¯åŸæœ¬ Flux æ¶æ„çš„ Storeï¼Œè€Œæ˜¯ Reducer Storeï¼Œè¿™ä¸ª Reducer Store æ˜¯ä¸€ä¸ªåœ¨ Flux ä¸­çš„ Store çš„è¿›åŒ–ç‰ˆï¼Œåœ¨è¯´æ˜ä¸­å®ƒæœ‰ä¸€ä¸ªå«åš `reduce` çš„æ–¹æ³•ã€‚

## ç»„æˆéƒ¨åˆ†

### Store

**Store** æ˜¯æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ•°æ®é›†åˆï¼Œå¹¶åŒ…å«äº†æ‰€æœ‰å¯¹æ•°æ®çš„å˜åŠ¨æ–¹æ³•ã€‚

é€šè¿‡ `redux` çš„ `createStore` API ç”Ÿæˆ Storeï¼Œè¯¥æ–¹æ³•å¯ä¼ ä¸‰ä¸ªå‚æ•°ï¼š

- `reducer`ï¼š
- `preloadedstate`ï¼šState çš„åˆå§‹å€¼
- `enhancer`ï¼š

è¿”å›å€¼ä¸ºå¯¹è±¡ç±»å‹ï¼Œå…·æœ‰ä»¥ä¸‹å±æ€§ï¼š

- `getState`ï¼šè·å–çŠ¶æ€ï¼ˆ`state`ï¼‰
- `dispatch`ï¼šè§¦å‘åŠ¨ä½œï¼ˆ`action`ï¼‰ï¼Œæ›´æ–°çŠ¶æ€ï¼ˆ`state`ï¼‰
- `subscribe`ï¼šè®¢é˜…æ•°æ®å˜æ›´ï¼Œæ³¨å†Œç›‘å¬å™¨ï¼ˆæ•°æ®å˜æ›´æ—¶è§¦å‘ï¼‰
- `replaceReducer`ï¼š
- `[$$observable]`ï¼š

```js
import { createStore } from 'redux';

function todos(state = [], action) {
  switch(action.type) {
    case 'ADD_TODO':
      return state.concat([action.text])
    default:
      return state;
  }
}

// const store = createStore(Reducer, initStore);
const store = createStore(todos, ['Coding']);

store.dispatch({
  type: 'ADD_TODO',
  text: 'Drinking coffe'
})

console.log(store.getState());
// [ 'Coding', 'Drinking coffee' ]
```

### Action

Action æ˜¯æŠŠæ•°æ®ä»åº”ç”¨ä¼ åˆ° Store çš„æœ‰æ•ˆè½½è·ï¼ˆPayloadï¼‰ã€‚å®ƒæ˜¯ Store æ•°æ®çš„å”¯ä¸€æ¥æºï¼Œä¹Ÿå°±æ˜¯è¯´è¦æ”¹å˜ Store ä¸­çš„ State å°±éœ€è¦è§¦å‘ä¸€ä¸ª Actionã€‚

Action æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œ`action` å†…å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ `type` å­—æ®µæ¥è¡¨ç¤ºå°†è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œé™¤äº† `type` å­—æ®µå¤–ï¼Œ`action` å¯¹è±¡çš„ç»“æ„å®Œå…¨ç”±ä½ æ¥å†³å®šã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œ`type` ä¼šè¢«å®šä¹‰æˆå­—ç¬¦ä¸²å¸¸é‡ã€‚å½“åº”ç”¨è§„æ¨¡è¶Šæ¥è¶Šå¤§æ—¶ï¼Œå»ºè®®ç”¨å•ç‹¬çš„æ¨¡å—æˆ–æ–‡ä»¶æ¥å­˜æ”¾ Action Typeã€‚

```js
import { createStore } from 'redux'
const store = createStore(todos, ['Use Redux'])

function addTodo(text) {
  return {
    type: 'ADD_TODO',
    text
  }
}

store.dispatch(addTodo('Read the docs'))
store.dispatch(addTodo('Read about the middleware'))
```

### Action Creator

```js
function addToDo(text) {
  return {
    type: 'ADD_TODO',
    text,
  };
}
```

è¿™æ ·å°†ä½¿ `action` åˆ›å»ºå‡½æ•°æ›´å®¹æ˜“è¢«ç§»åŠ¨å’Œæµ‹è¯•ã€‚

### Reducer

**Reducer** æ˜¯æ ¹æ® `action` ä¿®æ”¹ `store` å°†å…¶è½¬å˜æˆä¸‹ä¸€ä¸ª `state`ï¼Œè®°ä½ `actions` åªæè¿°äº†æœ‰äº‹æƒ…å‘ç”Ÿäº†è¿™ä¸€äº‹å®ï¼Œå¹¶æ²¡æœ‰æè¿°åº”ç”¨å¦‚ä½•æ›´æ–° `state`ã€‚

```js
(prevState, action) => nextState;
```

ä¿æŒ Reducer çº¯å‡€éå¸¸é‡è¦ã€‚æ°¸è¿œä¸è¦åœ¨ Reducer é‡Œåšè¿™äº›æ“ä½œï¼š

- ä¿®æ”¹ä¼ å…¥å‚æ•°
- æ‰§è¡Œæœ‰å‰¯ä½œç”¨ã€å¦‚ API è¯·æ±‚å’Œè·¯ç”±è·³è½¬
- è°ƒç”¨éçº¯å‡½æ•°ï¼Œå¦‚ `Date.now()` å’Œ `Math.random()`

```js
// reducer
function todoApp(state = initialState, action) {
  switch (action.type) {
    case SET_VISIBILITY_FILTER:
      return Obejct.assign({}, state, {
        visibilityFilter: action.filter,
      });
    default:
      return state;
  }
}
```

- ä¸è¦ç›´æ¥ä¿®æ”¹ State
  - ä½¿ç”¨ `Object.assign` æ–°å»ºä¸€ä¸ªå‰¯æœ¬ã€‚ä¸èƒ½è¿™æ ·ä½¿ç”¨ `Object.assign(state, { visibilityFilter: action.filter })`ï¼Œå› ä¸ºå®ƒä¼šæ”¹å˜ç¬¬ä¸€å‚æ•°çš„å€¼ã€‚ä½ å¿…é¡»æŠŠç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºç©ºå¯¹è±¡ã€‚
  - ä½ ä¹Ÿå¯ä»¥å¼€å¯å¯¹ ES7 ææ¡ˆå¯¹è±¡å±•å¼€è¿ç®—ç¬¦çš„æ”¯æŒï¼Œä»è€Œä½¿ç”¨ `{...state, visibilityFilter: action.filter}` è¾¾åˆ°ç›¸åŒçš„ç›®çš„
- åœ¨ `default` æƒ…å†µä¸‹è¿”å›æ—§çš„ `state`ã€‚é‡åˆ°æœªçŸ¥çš„ `action` æ—¶ï¼Œä¸€å®šè¦è¿”å›æ—§çš„ stateã€‚

```js
// A normal Reducer
const initList = [];
function ListReducer(state = initList, action) {
  switch (action.type) {
    case 'ADD_LIST':
      return state.concat([action.item]);
      break;
    default:
      return state;
  }
}
```

âš ï¸ **æ³¨æ„äº‹é¡¹ï¼š**

- éµå®ˆæ•°æ®ä¸å¯å˜åŸåˆ™ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹ Stateï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡
- é»˜è®¤æƒ…å†µä¸‹éœ€è¦è¿”å›åŸæ•°æ®ï¼Œé¿å…æ•°æ®è¢«æ¸…ç©º
- æœ€å¥½è®¾ç½®åˆå§‹å€¼ï¼Œä¾¿äºåº”ç”¨çš„åˆå§‹åŒ–åŠæ•°æ®ç¨³å®š

## å·¥ä½œæµç¨‹

1. ç”¨æˆ·ï¼ˆæ“ä½œ Viewï¼‰å‘å‡º Actionï¼Œå‘å‡ºæ–¹å¼å°±ç”¨åˆ°äº† `store.dispatch` æ–¹æ³•
2. ç„¶åï¼ŒStore è‡ªåŠ¨è°ƒç”¨ Reducerï¼Œå¹¶ä¸”ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼ˆå½“å‰ State å’Œæ”¶åˆ° Actionï¼‰ï¼ŒReducer æ ¹æ® Action è¿”å›æ–°çš„ Stateï¼Œå¦‚æœæœ‰ Middlewareï¼ŒStore ä¼šå°†å½“å‰ State å’Œæ”¶åˆ°çš„ Action ä¼ é€’ç»™ Middlewareï¼ŒMiddleware ä¼šè°ƒç”¨ Reducer ç„¶åè¿”å›æ–°çš„ State
3. State ä¸€æ—¦æœ‰å˜åŒ–ï¼ŒStore å°±ä¼šè°ƒç”¨ç›‘å¬å‡½æ•°ï¼Œæ¥æ›´æ–° View

## å¯¹æ¯”æµ‹è¯„

### è‡ªæˆ‘è¯„ä»·

ä¼˜ç‚¹ï¼š

- å¯é¢„æµ‹ï¼šå§‹ç»ˆæœ‰ä¸€ä¸ªå”¯ä¸€å‡†ç¡®çš„æ•°æ®æºï¼ˆsingle source of truthï¼‰å³ Storeï¼Œå› æ­¤ä¸å­˜åœ¨å¦‚ä½•å°†å½“å‰çŠ¶æ€ Store ä¸åŠ¨ä½œå’Œåº”ç”¨çš„å…¶ä»–éƒ¨åˆ†åŒæ­¥çš„é—®é¢˜
- æ˜“ç»´æŠ¤ï¼šå…·å¤‡å¯é¢„æµ‹çš„ç»“æœå’Œä¸¥æ ¼çš„ç»„ç»‡ç»“æ„è®©ä»£ç æ›´å®¹æ˜“ç»´æŠ¤
- æ˜“æµ‹è¯•ï¼šç¼–å†™å¯æµ‹è¯•ä»£ç çš„é¦–è¦å‡†åˆ™æ˜¯ç¼–å†™å¯ä»¥ä»…åšä¸€ä»¶äº‹å¹¶ä¸”ç‹¬ç«‹çš„å°å‡½æ•°ï¼ˆsingle responsibility principleï¼‰ï¼ŒRedux çš„ä»£ç å‡ ä¹å…¨éƒ¨éƒ½æ˜¯è¿™æ ·çš„å‡½æ•°ï¼šçŸ­å°ã€çº¯ç²¹ã€åˆ†ç¦»

ç¼ºé™·ï¼š

- ä¸€ä¸ªç»„ä»¶æ‰€éœ€è¦çš„æ•°æ®ï¼Œå¿…é¡»ç”±çˆ¶ç»„ä»¶ä¼ è¿‡æ¥ï¼Œè€Œä¸èƒ½åƒ Flux ä¸­ç›´æ¥ ä» Store å–ã€‚
- å½“ä¸€ä¸ªç»„ä»¶ç›¸å…³æ•°æ®æ›´æ–°æ—¶ï¼Œå³ä½¿çˆ¶ç»„ä»¶ä¸éœ€è¦ç”¨åˆ°è¿™ä¸ªç»„ä»¶ï¼Œçˆ¶ç»„ä»¶è¿˜æ˜¯ä¼š `re-render`ï¼Œå¯èƒ½ä¼šæœ‰æ•ˆç‡å½±å“ï¼Œæˆ–è€…éœ€è¦å†™å¤æ‚çš„ `shouldComponentUpdate` è¿›è¡Œåˆ¤æ–­ã€‚

### ä¸ Flux å¯¹æ¯”

Redux æ˜¯ Flux æ¶æ„æ€æƒ³çš„å®è·µæ–¹æ¡ˆï¼ŒåŒæ—¶åˆåœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›ã€‚Redux æ‰¿è½½äº† Flux å•å‘æ•°æ®æµã€Store æ˜¯å”¯ä¸€çš„æ•°æ®æºçš„æ€æƒ³ã€‚

- Redux ä¸­æ²¡æœ‰ Dispatcherï¼šå®ƒä½¿ç”¨ Store çš„ `Store.dispatch` æ–¹æ³•æ¥æŠŠ action ä¼ ç»™ Storeï¼Œç”±äºæ‰€æœ‰çš„ action å¤„ç†éƒ½ä¼šç»è¿‡è¿™ä¸ª `Store.dispatch` æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨ Redux ä¸­å¾ˆå®¹æ˜“å®ç° Middleware æœºåˆ¶ã€‚Middleware å¯ä»¥è®©ä½ åœ¨ `reducer` æ‰§è¡Œä¸æ‰§è¡Œåè¿›è¡Œæ‹¦æˆªå¹¶æ’å…¥ä»£ç ï¼Œæ¥è¾¾åˆ°æ“ä½œ `action` å’Œ `store` çš„ç›®çš„ï¼Œè¿™æ ·ä¸€æ¥å¾ˆå®¹æ˜“å®ç°çµæ´»çš„æ—¥å¿—æ‰“å°ã€é”™è¯¯æ”¶é›†ã€API è¯·æ±‚ã€è·¯ç”±ç­‰æ“ä½œã€‚
- Redux ä»…æœ‰ä¸€ä¸ª Storeï¼šFlux ä¸­å…è®¸æœ‰å¤šä¸ª Storeï¼Œä½†æ˜¯ Redux åªå…è®¸æœ‰ä¸€ä¸ªï¼Œç›¸è¾ƒäºå¤šä¸ª Store çš„ Fluxï¼Œä¸€ä¸ª Store æ›´åŠ æ¸…æ™°ï¼Œå¹¶æ˜“äºç®¡ç†

| Flux                            | Redux                         |
| :------------------------------- | :----------------------------- |
| Store åŒ…å«çŠ¶æ€å’Œæ›´æ”¹é€»è¾‘        | Store å’Œæ›´æ”¹é€»è¾‘æ˜¯åˆ†å¼€çš„      |
| æœ‰å¤šä¸ª Store                    | åªæœ‰ä¸€ä¸ª Store                |
| æ‰€æœ‰ Store éƒ½äº’ä¸å½±å“ä¸”æ˜¯å¹³çº§çš„ | å¸¦æœ‰åˆ†å±‚ reducer çš„å•ä¸€ Store |
| æœ‰å•ä¸€è°ƒåº¦å™¨                    | æ²¡æœ‰è°ƒåº¦å™¨çš„æ¦‚å¿µ              |
| React ç»„ä»¶è®¢é˜… Store            | å®¹å™¨ç»„ä»¶æ˜¯æœ‰è”ç³»çš„            |
| çŠ¶æ€æ˜¯å¯å˜çš„                    | çŠ¶æ€æ˜¯ä¸å¯æ”¹å˜çš„              |

## ä¸ºä»€ä¹ˆè¦ç”¨ Reduxï¼Ÿ

éšç€ JavaScript åº”ç”¨è¶Šæ¥è¶Šå¤§ï¼Œè¶Šæ¥è¶Šå¤æ‚ï¼Œæˆ‘ä»¬éœ€è¦ç®¡ç†çš„ State å˜å¾—è¶Šæ¥è¶Šå¤šã€‚è¿™äº› State å¯èƒ½åŒ…æ‹¬æœåŠ¡å™¨å“åº”ã€ç¼“å­˜æ•°æ®ã€æœ¬åœ°ç”Ÿæˆå°šæœªæŒä¹…åŒ–åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼Œä¹ŸåŒ…æ‹¬ UI çŠ¶æ€ï¼Œå¦‚æ¿€æ´»çš„è·¯ç”±ï¼Œè¢«é€‰ä¸­çš„æ ‡ç­¾ï¼Œæ˜¯å¦æ˜¾ç¤ºåŠ è½½åŠ¨æ•ˆæˆ–è€…åˆ†é¡µå™¨ç­‰ã€‚

ç®¡ç†ä¸æ–­å˜åŒ–çš„ `state` éå¸¸å›°éš¾ã€‚å¦‚æœä¸€ä¸ª `model` çš„å˜åŒ–ä¼šå¼•èµ·å¦ä¸€ä¸ª `model` çš„å˜åŒ–ï¼Œé‚£ä¹ˆå½“ `view` å˜åŒ–æ—¶ï¼Œå°±å¯èƒ½å¼•èµ·å¯¹åº” `model` ä»¥åŠå¦ä¸€ä¸ª `model` çš„å˜åŒ–ï¼Œä¾æ¬¡åœ°ï¼Œå¯èƒ½ä¼šå¼•èµ·å¦ä¸€ä¸ª `view` çš„å˜åŒ–ã€‚ç›´è‡³ä½ æä¸æ¸…æ¥šåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚`state` åœ¨ä»€ä¹ˆæ—¶å€™ï¼Œç”±äºä»€ä¹ˆåŸå› ï¼Œå¦‚ä½•å˜åŒ–å·²ç„¶ä¸å—æ§åˆ¶ã€‚å½“ç³»ç»Ÿå˜å¾—é”™ç»¼å¤æ‚æ—¶ï¼Œæƒ³é‡ç°é—®é¢˜æˆ–è€…æ·»åŠ æ–°åŠŸèƒ½å°±ä¼šå˜å¾—éå¸¸å¤æ‚ã€‚

è™½ç„¶ React è¯•å›¾åœ¨è¯•å›¾å±‚ç¦æ­¢å¼‚æ­¥å’Œç›´æ¥æ“ä½œ DOM æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼ŒReact ä¾æ—§æŠŠå¤„ç† State ä¸­æ•°æ®çš„é—®é¢˜ç•™ç»™äº†ä½ ã€‚Redux å°±æ˜¯ä¸ºäº†å¸®ä½ è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚

Redux åº”ç”¨ä¸­æ‰€æœ‰çš„ State éƒ½ä»¥ä¸€ä¸ªå¯¹è±¡æ ‘çš„å½¢å¼å‚¨å­˜åœ¨ä¸€ä¸ªå•ä¸€çš„ Store ä¸­ï¼Œå”¯ä¸€æ”¹å˜ State çš„åŠæ³•æ˜¯è§¦å‘ `action`ï¼Œ`action` æ˜¯ä¸€ä¸ªæè¿°å‘ç”Ÿäº†ä»€ä¹ˆçš„å¯¹è±¡ã€‚ä¸ºäº†æè¿° `action` å¦‚ä½•æ”¹å˜ State æ ‘ï¼Œä½ éœ€è¦ç¼–å†™ `reducers`ã€‚

ğŸŒ° **æ ‡å‡†ç¤ºä¾‹ï¼š**

```js
import { createStore } from 'redux';
/**
 * è¿™æ˜¯ä¸€ä¸ª reducerï¼Œå½¢å¼ä¸º (state, action) => state çš„çº¯å‡½æ•°
 * æè¿°äº† action å¦‚ä½•æŠŠ state è½¬å˜æˆä¸‹ä¸€ä¸ª state
 *
 * state çš„å½¢å¼å–å†³äºä½ ï¼Œå¯ä»¥æ˜¯åŸºæœ¬ç±»å‹ã€æ•°ç»„ã€å¯¹è±¡
 * å½“ state ä¿®æ”¹æ—¶éœ€è¦è¿”å›å…¨æ–°çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ä¼ å…¥çš„å‚æ•°
 *
 * ä¸‹é¢ä¾‹å­ä½¿ç”¨ `switch` è¯­å¥å’Œå­—ç¬¦ä¸²æ¥åšåˆ¤æ–­ï¼Œä½†ä½ å¯ä»¥å†™å¸®åŠ©ç±»ï¼ˆhelperï¼‰
 * æ ¹æ®ä¸åŒçš„çº¦å®šï¼ˆå¦‚æ–¹æ³•æ˜ å°„ï¼‰æ¥åˆ¤æ–­ï¼Œåªè¦é€‚ç”¨äºä½ çš„é¡¹ç›®å°±å¯ä»¥äº†
 */
function counter(state = 0, action) {
  switch ((action, type)) {
    case 'INCREMENT':
      return state + 1;
    case 'DECREMENT':
      return state - 1;
    default:
      return state;
  }
}

// åˆ›å»º Redux Store æ¥å­˜æ”¾åº”ç”¨çŠ¶æ€
// API æ˜¯ { subscribe, dispatch, getState }
let store = createStore(counter);

// å¯ä»¥æ‰‹åŠ¨è®¢é˜…æ›´æ–°ï¼Œä¹Ÿå¯ä»¥äº‹ä»¶ç»‘å®šåˆ°è§†å›¾å±‚
store.subscribe(() => {
  console.log(store.getState());
});

// æ”¹å˜å†…éƒ¨ state å”¯ä¸€æ–¹æ³•æ˜¯ dispatch ä¸€ä¸ª action
// action å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œç”¨æ—¥è®°è®°å½•å’Œå‚¨å­˜ä¸‹æ¥ï¼ŒåæœŸè¿˜å¯ä»¥å›æ”¾çš„æ–¹å¼æ‰§è¡Œ
store.dispatch({ type: 'INCREMENT' });
// 1
store.dispatch({ type: 'INCREMENT' });
// 2
store.dispatch({ type: 'DECREMENT' });
// 1
```

## å¼‚æ­¥æ•°æ®æµ

- redux-thunk
- redux-promise
- redux-saga
- redux-persistï¼šæ”¯æŒ Store æœ¬åœ°æŒä¹…åŒ–
- redux-observableï¼šå®ç°å¯å–æ¶ˆçš„ action

---

**å‚è€ƒèµ„æ–™ï¼š**

- [ğŸ“– Redux ä¸­æ–‡æ–‡æ¡£](https://github.com/camsong/redux-in-chinese)
- [ğŸ“ Redux æºç åˆ†æä¸è®¾è®¡æ€è·¯åˆ†æ](https://github.com/WisestCoder/blog/issues/1)
- [ğŸ“ å•é¡µåº”ç”¨çš„æ•°æ®æµæ–¹æ¡ˆæ¢ç´¢](https://zhuanlan.zhihu.com/p/26426054)
- [ğŸ“ Redux æ¦‚å¿µä¹‹ä¸€ï¼šRedux ç®€ä»‹](https://www.imooc.com/article/16061)
- [ğŸ“ Redux æ¦‚å¿µä¹‹äºŒï¼šRedux çš„ä¸‰å¤§åŸåˆ™](https://www.imooc.com/article/16062)
- [ğŸ“ Redux æ¦‚å¿µä¹‹ä¸‰ï¼šAction ä¸ ActionCreator](https://www.imooc.com/article/16063)
- [ğŸ“ Redux æ¦‚å¿µä¹‹å››ï¼šReducer ä¸çº¯å‡½æ•°](https://www.imooc.com/article/16064)
- [ğŸ“ Redux æ¦‚å¿µä¹‹äº”ï¼šRedux å¥—ç”¨ä¸ƒæ­¥éª¤](https://www.imooc.com/article/16065)
- [å¦‚ä½•åœ¨ React+Redux çš„é¡¹ç›®ä¸­æ›´ä¼˜é›…çš„å®ç°å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•](https://testerhome.com/topics/8032)
- [Redux ä»è®¾è®¡åˆ°æºç ](https://tech.meituan.com/2017/07/14/redux-design-code.html)
- [Vuexã€Fluxã€Reduxã€Redux-sagaã€Dvaã€MobX](https://zhuanlan.zhihu.com/p/53599723)
- [Fluxã€Reduxã€Vuexã€MobX æ€»ç»“ï¼ˆæ¦‚å¿µç¯‡ï¼‰](https://zhuanlan.zhihu.com/p/75696114)
