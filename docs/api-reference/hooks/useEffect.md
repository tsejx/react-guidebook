---
nav:
  title: API
  order: 4
group:
  title: Hooks API
  order: 3
title: useEffect
order: 2
---

# useEffect

å®˜æ–¹æ–‡æ¡£ï¼š[ä½¿ç”¨ Effect Hook](https://reactjs.bootcss.com/docs/hooks-effect.html)

Effect Hook å¯ä»¥è®©ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œã€‚

## åŸºæœ¬ç”¨æ³•

è¯­æ³•ï¼š

```js
useEffect(create, deps);
```

ç±»å‹å£°æ˜ï¼š

```ts
export function useEffect(
  create: () => (() => void) | void,
  deps: Array<mixed> | void | null
): void {
  const dispatcher = resolveDispatcher();
  return dispatcher.useEffect(create, deps);
}
```

è¯´æ˜ï¼š

- å‚æ•°ï¼šè¯¥ Hook æ¥æ”¶ä¸€ä¸ªåŒ…å«å‘½ä»¤å¼ã€ä¸”å¯èƒ½æœ‰å‰¯ä½œç”¨ä»£ç çš„**å‡½æ•°**ã€‚
- å‚æ•° `create` å‡½æ•°è¿”å›å€¼ï¼šå…¥å‚å‡½æ•°å¯ä»¥ä¸è¿”å›ä»»ä½•å€¼ï¼Œæˆ–è¿”å›ç”¨äºç»„ä»¶å¸è½½æ—¶éœ€è¦æ¸…é™¤å‰¯ä½œç”¨è®¢é˜…æˆ–ç›‘å¬çš„é€»è¾‘å‡½æ•°ï¼ˆè¯¦ç»†æŸ¥é˜… [æ¸…é™¤å‡½æ•°](#æ¸…é™¤å‡½æ•°)ï¼‰
- æ‰§è¡Œæ—¶æœºï¼šä½¿ç”¨ `useEffect` å®Œæˆå‰¯ä½œç”¨æ“ä½œã€‚èµ‹å€¼ç»™ `useEffect` çš„å‡½æ•°ä¼šåœ¨ **ç»„ä»¶æ¸²æŸ“åˆ°å±å¹•ä¹‹å** æ‰§è¡Œ

âš ï¸ **æ³¨æ„**ï¼š

- é»˜è®¤æƒ…å†µä¸‹ï¼Œ`effect` å°†åœ¨æ¯è½®æ¸²æŸ“ç»“æŸåæ‰§è¡Œï¼Œä½†ä½ å¯ä»¥é€‰æ‹©è®©å®ƒ **åœ¨åªæœ‰æŸäº›å€¼æ”¹å˜çš„æ—¶å€™** æ‰æ‰§è¡Œã€‚
- åœ¨å‡½æ•°ç»„ä»¶ä¸»ä½“å†…ï¼ˆè¿™é‡ŒæŒ‡åœ¨ React æ¸²æŸ“é˜¶æ®µï¼‰æ”¹å˜ DOMã€æ·»åŠ è®¢é˜…ã€è®¾ç½®å®šæ—¶å™¨ã€è®°å½•æ—¥å¿—ä»¥åŠæ‰§è¡Œå…¶ä»–åŒ…å«å‰¯ä½œç”¨çš„æ“ä½œéƒ½æ˜¯ä¸è¢«å…è®¸çš„ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šäº§ç”Ÿè«åå…¶å¦™çš„ BUG å¹¶ç ´å UI çš„ä¸€è‡´æ€§ã€‚

### æ¸…é™¤å‡½æ•°

é€šå¸¸ï¼Œç»„ä»¶å¸è½½æ—¶éœ€è¦æ‰§è¡Œæ¸…é™¤ `effect` åˆ›å»ºçš„è¯¸å¦‚è®¢é˜…æˆ–è®¡æ—¶å™¨ç­‰é€»è¾‘ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œ`useEffect` å‡½æ•°éœ€è¿”å›ä¸€ä¸ª **æ¸…é™¤å‡½æ•°**ã€‚

ä»¥ä¸‹å°±æ˜¯ä¸€ä¸ªåˆ›å»ºè®¢é˜…çš„ä¾‹å­ï¼š

```js
useEffect(() => {
  const subscription = props.source.subscribe();

  return () => {
    // æ¸…é™¤è®¢é˜…
    subscription.unsubscribe();
  };
}, []);
```

âš ï¸ **æ³¨æ„**ï¼š

- ä¸º **é˜²æ­¢å†…å­˜æ³„æ¼**ï¼Œæ¸…é™¤å‡½æ•°ä¼šåœ¨ **ç»„ä»¶å¸è½½å‰** æ‰§è¡Œï¼›
- å¦å¤–ï¼Œå¦‚æœç»„ä»¶å¤šæ¬¡æ¸²æŸ“ï¼ˆé€šå¸¸å¦‚æ­¤ï¼‰ï¼Œåˆ™åœ¨ **æ‰§è¡Œä¸‹ä¸€ä¸ª effect ä¹‹å‰ï¼Œä¸Šä¸€ä¸ª effect å°±å·²è¢«æ¸…é™¤**ã€‚

åœ¨ä¸Šè¿°ä»£ç ç¤ºä¾‹ä¸­ï¼Œæ„å‘³ç€ç»„ä»¶çš„æ¯æ¬¡æ›´æ–°éƒ½ä¼šåˆ›å»ºæ–°çš„è®¢é˜…ã€‚è‹¥æƒ³é¿å…æ¯æ¬¡æ›´æ–°éƒ½è§¦å‘ effect çš„æ‰§è¡Œï¼Œè¯·å‚é˜…ä¸‹ä¸€å°èŠ‚ [æ‰§è¡Œæ—¶æœº](#æ‰§è¡Œæ—¶æœº)ã€‚

### æ‰§è¡Œæ—¶æœº

ä¸ `componentDidMount`ã€`componentDidUpdate` ä¸åŒçš„æ˜¯ï¼Œåœ¨æµè§ˆå™¨å®Œæˆå¸ƒå±€ä¸ç»˜åˆ¶ä¹‹åï¼Œä¼ ç»™ `useEffect` çš„å‡½æ•°ä¼š **å»¶è¿Ÿè°ƒç”¨**ã€‚è¿™ä½¿å¾—å®ƒé€‚ç”¨äºè®¸å¤šå¸¸è§çš„å‰¯ä½œç”¨åœºæ™¯ï¼Œæ¯”å¦‚è®¾ç½®è®¢é˜…å’Œäº‹ä»¶å¤„ç†ç­‰æƒ…å†µï¼Œå› æ­¤ **ä¸åº”åœ¨å‡½æ•°ä¸­æ‰§è¡Œé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•** çš„æ“ä½œã€‚

ç„¶è€Œï¼Œå¹¶éæ‰€æœ‰ effect éƒ½å¯ä»¥è¢«å»¶è¿Ÿæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨æµè§ˆå™¨æ‰§è¡Œä¸‹ä¸€æ¬¡ç»˜åˆ¶å‰ï¼Œç”¨æˆ·å¯è§çš„ DOM å˜æ›´å°±å¿…é¡»åŒæ­¥æ‰§è¡Œï¼Œè¿™æ ·ç”¨æˆ·æ‰ä¸ä¼šæ„Ÿè§‰åˆ°è§†è§‰ä¸Šçš„ä¸ä¸€è‡´ã€‚ï¼ˆæ¦‚å¿µä¸Šç±»ä¼¼äºè¢«åŠ¨ç›‘å¬äº‹ä»¶å’Œä¸»åŠ¨ç›‘å¬äº‹ä»¶çš„åŒºåˆ«ï¼‰React ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªé¢å¤–çš„ `useLayoutEffect` Hook æ¥å¤„ç†è¿™ç±» effectã€‚å®ƒå’Œ `useEffect` çš„ç»“æ„ç›¸åŒï¼ŒåŒºåˆ«åªæ˜¯ **è°ƒç”¨æ—¶æœº** ä¸åŒã€‚

è™½ç„¶ `useEffect` ä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åå»¶è¿Ÿæ‰§è¡Œï¼Œä½†ä¼šä¿è¯åœ¨ä»»ä½•æ–°çš„æ¸²æŸ“å‰æ‰§è¡Œã€‚React å°†åœ¨ç»„ä»¶æ›´æ–°å‰åˆ·æ–°ä¸Šä¸€è½®æ¸²æŸ“çš„ effectã€‚

### æ¡ä»¶æ‰§è¡Œ

é»˜è®¤æƒ…å†µä¸‹ï¼Œeffect ä¼šåœ¨æ¯è½®ç»„ä»¶æ¸²æŸ“å®Œæˆåæ‰§è¡Œã€‚è¿™æ ·çš„è¯ï¼Œä¸€æ—¦ effect çš„ä¾èµ–å‘ç”Ÿå˜åŒ–ï¼Œå®ƒå°±ä¼šè¢«é‡æ–°åˆ›å»ºã€‚

ç„¶è€Œï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹è¿™ä¹ˆåšå¯èƒ½ä¼šçŸ«æ‰è¿‡æ­£ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸Šä¸€ç« èŠ‚çš„è®¢é˜…ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯æ¬¡ç»„ä»¶æ›´æ–°æ—¶éƒ½åˆ›å»ºæ–°çš„è®¢é˜…ï¼Œè€Œæ˜¯ä»…éœ€è¦åœ¨ `prop.source` æ”¹å˜æ—¶é‡æ–°åˆ›å»ºã€‚

è¦å®ç°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥ç»™ `useEffect` ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒæ˜¯ effect æ‰€ä¾èµ–çš„å€¼æ•°ç»„ã€‚æ›´æ–°åçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```js
useEffect(() => {
  const subscription = props.source.subscribe();

  return () => {
    subscription.unsubscribe();
  };
}, [props.source]);
```

æ­¤æ—¶ï¼Œåªæœ‰å½“ `props.source` æ”¹å˜åæ‰ä¼šé‡æ–°åˆ›å»ºè®¢é˜…ã€‚

> âš ï¸ **æ³¨æ„ï¼š**
>
> å¦‚æœä½ è¦ä½¿ç”¨æ­¤ä¼˜åŒ–æ–¹å¼ï¼Œè¯·ç¡®ä¿æ•°ç»„ä¸­åŒ…å«äº†æ‰€æœ‰å¤–éƒ¨ä½œç”¨åŸŸä¸­ä¼šéšæ—¶é—´å˜åŒ–å¹¶ä¸”åœ¨ `effect` ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œå¦åˆ™ä½ çš„ä»£ç ä¼šå¼•ç”¨åˆ°å…ˆå‰æ¸²æŸ“ä¸­çš„æ—§å˜é‡ã€‚å‚é˜…æ–‡æ¡£ï¼Œäº†è§£æ›´å¤šå…³äº [å¦‚ä½•å¤„ç†å‡½æ•°](https://zh-hans.reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies) ä»¥åŠ [æ•°ç»„é¢‘ç¹å˜åŒ–æ—¶çš„æªæ–½](https://zh-hans.reactjs.org/docs/hooks-faq.html#what-can-i-do-if-my-effect-dependencies-change-too-often) å†…å®¹ã€‚
>
> å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ`[]`ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™å°±ç›¸å½“äºå‘Šè¯‰ React ä½ çš„ effect ä¸ä¾èµ–äº `props` æˆ– `state` ä¸­çš„ä»»ä½•å€¼ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œéƒ½ä¸éœ€è¦é‡å¤æ‰§è¡Œã€‚è¿™å¹¶ä¸å±äºç‰¹æ®Šæƒ…å†µ â€”â€” å®ƒä¾ç„¶éµå¾ªä¾èµ–æ•°ç»„çš„å·¥ä½œæ–¹å¼ã€‚
>
> å¦‚æœä½ ä¼ å…¥äº†ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ`[]`ï¼‰ï¼Œeffect å†…éƒ¨çš„ `props` å’Œ `state` å°±ä¼šä¸€ç›´æ‹¥æœ‰å…¶åˆå§‹å€¼ã€‚å°½ç®¡ä¼ å…¥ `[]` ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æ›´æ¥è¿‘å¤§å®¶æ›´ç†Ÿæ‚‰çš„ `componentDidMount` å’Œ `componentWillUnmount` æ€ç»´æ¨¡å¼ï¼Œä½†æˆ‘ä»¬æœ‰æ›´å¥½çš„æ–¹å¼æ¥é¿å…è¿‡äºé¢‘ç¹çš„é‡å¤è°ƒç”¨ effectã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¯·è®°å¾— React ä¼šç­‰å¾…æµè§ˆå™¨å®Œæˆç”»é¢æ¸²æŸ“ä¹‹åæ‰ä¼šå»¶è¿Ÿè°ƒç”¨ `useEffect`ï¼Œå› æ­¤ä¼šä½¿å¾—é¢å¤–æ“ä½œå¾ˆæ–¹ä¾¿ã€‚
>
> æˆ‘ä»¬æ¨èå¯ç”¨ `eslint-plugin-react-hooks` ä¸­çš„ `exhaustive-deps` è§„åˆ™ã€‚æ­¤è§„åˆ™ä¼šåœ¨æ·»åŠ é”™è¯¯ä¾èµ–æ—¶å‘å‡ºè­¦å‘Šå¹¶ç»™å‡ºä¿®å¤å»ºè®®ã€‚

ä¾èµ–é¡¹æ•°ç»„ä¸ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ effect å‡½æ•°ã€‚è™½ç„¶ä»æ¦‚å¿µä¸Šæ¥è¯´å®ƒè¡¨ç°ä¸ºï¼šæ‰€æœ‰ effect å‡½æ•°ä¸­å¼•ç”¨çš„å€¼éƒ½åº”è¯¥å‡ºç°åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­ã€‚æœªæ¥ç¼–è¯‘å™¨ä¼šæ›´åŠ æ™ºèƒ½ï¼Œå±Šæ—¶è‡ªåŠ¨åˆ›å»ºæ•°ç»„å°†æˆä¸ºå¯èƒ½ã€‚

## å‚è€ƒèµ„æ–™

- [ğŸ“ useEffect å®Œå…¨æŒ‡å—](https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/)
- [ğŸ“ ç²¾åº¦ã€ŠuseEffect å®Œå…¨æŒ‡å—ã€‹](https://juejin.im/post/5c9827745188250ff85afe50)
