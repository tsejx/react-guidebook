## Lifecycle ç”Ÿå‘½å‘¨æœŸå‡½æ•°

ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯åœ¨ç»„ä»¶çš„ä¸åŒé˜¶æ®µå¯æ‰§è¡Œè‡ªå®šä¹‰åŠŸèƒ½çš„é’©å­ã€‚

- Mounting

  - [**`constructor()`**](#constructor)
  - `static getDerivedStateFromProps()`
  - âš ï¸ [`UNSAFE_componentWillMount()`](UNSAFE_componentWillMount)
  - [**`render()`**](#render)
  - **`componentDidMount()`**
- Updating

  - `static getDerivedStateFromProps()`
  - `shouldComponentUpdate()`
  - **`render()`**
  - `getSnapshotBeforeUpdate()`
  - **`componentDidMount()`**
- Unmounting

  - **`componentWillUnmount()`**
- Error Handling
  - `static getDerivedStateFromError()`
  - `componentDidCatch()`

çŠ¶æ€ç»„ä»¶çš„3ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µ

çŠ¶æ€ç»„ä»¶ä¸»è¦é€šè¿‡3ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µæ¥ç®¡ç†ï¼Œåˆ†åˆ«æ˜¯ `MOUNTING`ï¼Œ`RECEIVE_PROPS` å’Œ `UNMOUNTING`ã€‚

1. å…¶ä¸­ `will` å‰ç¼€çš„æ–¹æ³•æ˜¯è¿›å…¥çŠ¶æ€ä¹‹å‰çš„è°ƒç”¨ï¼Œæ¯”å¦‚ `componentWillReceiveProps`ï¼Œæ­¤æ–¹æ³•ä¸­æ”¹å˜ state ä¸ä¼šäºŒæ¬¡æ¸²æŸ“è€Œæ˜¯è¿›è¡Œ state åˆå¹¶ï¼Œå¹¶ä¸”åªæœ‰åœ¨ `componentDidUpdate` åæ‰èƒ½è·å–æ›´æ–°åçš„ this.stateã€‚å¦‚æœæƒ³è·å–ç»„ä»¶é»˜è®¤çš„ propsï¼Œå¹¶ä¸”èµ‹å€¼ç»™ State ï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹ï¼Œè¾¾åˆ°UIä¸Šçš„æ•ˆæœã€‚
2. `did` çš„å‰ç¼€è¡¨ç¤ºè¿›å…¥çŠ¶æ€ä¹‹åè°ƒç”¨ï¼Œæ¯”å¦‚ `componentDidMount`ï¼Œç»„ä»¶ä¸€èˆ¬åˆå§‹åŒ–éƒ½ä¼šåœ¨è¿™é‡Œè¿›è¡Œæ•°æ®è¯·æ±‚ã€‚

### è£…è½½é˜¶æ®µ Mounting

è£…è½½é˜¶æ®µæ‰§è¡Œçš„æ–¹æ³•ä¼šåœ¨ç»„ä»¶å®ä¾‹è¢«åˆ›å»ºå’Œæ’å…¥DOMä¸­æ—¶è¢«è°ƒç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸»è¦å®ç°ç»„ä»¶**çŠ¶æ€çš„åˆå§‹åŒ–**ã€‚

#### constructor

**æ„é€ å‡½æ•°**ã€‚åœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ã€‚

ä¸€ä¸ªç»„ä»¶éœ€è¦æ„é€ å‡½æ•°çš„ç›®çš„ï¼š

- è®¾ç½®åˆå§‹åŒ–çŠ¶æ€ï¼šå› ä¸ºç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­ä»»ä½•å‡½æ•°éƒ½å¯èƒ½è¦è®¿é—® Stateï¼Œé‚£ä¹ˆæ•´ä¸ªå‘¨æœŸä¸­ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„æ„é€ å‡½æ•°ä¾¿æ˜¯åˆå§‹åŒ– State æœ€ç†æƒ³çš„åœ°æ–¹ï¼›
- ç»‘å®šæˆå‘˜å‡½æ•°ä¸Šä¸‹æ–‡å¼•ç”¨
  - å› ä¸ºåœ¨ ES6 è¯­æ³•ä¸‹ï¼Œç±»çš„æ¯ä¸ªæˆå‘˜å‡½æ•°åœ¨æ‰§è¡Œæ—¶çš„ `this` å¹¶ä¸æ˜¯å’Œç±»å®ä¾‹è‡ªåŠ¨ç»‘å®šçš„ï¼›
  - è€Œåœ¨æ„é€ å‡½æ•°ä¸­ `this` å°±æ˜¯å½“å‰ç»„ä»¶å®ä¾‹ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†æ–¹ä¾¿å°†æ¥è°ƒç”¨ï¼Œå¾€å¾€åœ¨æ„é€ å‡½æ•°ä¸­å°†è¿™ä¸ªå®ä¾‹çš„ç‰¹å®šå‡½æ•°ç»‘å®š `this` ä¸ºå½“å‰ç±»å®ä¾‹ï¼›
  - å»ºè®®å®šä¹‰å‡½æ•°æ–¹æ³•æ—¶ç›´æ¥ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå°±æ— é¡»åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œå‡½æ•°çš„ `bind` æ“ä½œã€‚

åœ¨ ES6 ä¸­ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­é€šè¿‡ `this.state` èµ‹å€¼å®ŒæˆçŠ¶æ€åˆå§‹åŒ–ï¼›é€šè¿‡ç»™ç±»å±æ€§ï¼ˆæ³¨æ„æ˜¯ç±»å±æ€§ï¼Œè€Œä¸æ˜¯ç±»å®ä¾‹å¯¹è±¡çš„å±æ€§ï¼‰`defaultProps` èµ‹å€¼æŒ‡å®šçš„ Props åˆå§‹å€¼ã€‚

```js
class Sample extends React.Component {
    constructor(props){
        super(props);
        this.state = {
           foo: 'InitailValue' 
        }
    }
}

Sample.defaultProps = {
    bar: 'InitialValue'
}
```

#### static getDerivedStateFromProps(nextProps, prevState)

ç»„ä»¶åŒ–å®ä¾‹åŒ–åå’Œæ¥å—æ–° Props æ—¶å°†ä¼šè°ƒç”¨è¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚å®ƒåº”è¯¥è¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–° Stateï¼Œæˆ–è€…è¿”å› `null` æ¥è¡¨æ˜æ–° Props ä¸éœ€è¦æ›´æ–°ä»»ä½• Stateã€‚

ä¸ `componentDidUpdate` ä¸€èµ·ï¼Œè¿™ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸåº”è¯¥è¦†ç›–ä¼ ç»Ÿ `componentWillReceiveProps` çš„æ‰€æœ‰ç”¨ä¾‹ã€‚

- âš ï¸ æ³¨æ„ï¼Œå¦‚æœçˆ¶ç»„ä»¶å¯¼è‡´äº†ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œå³ä½¿å±æ€§æ²¡æœ‰æ›´æ–°ï¼Œè¿™ä¸€æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚å¦‚æœä½ åªæƒ³å¤„ç†å˜åŒ–ï¼Œä½ å¯èƒ½æƒ³å»æ¯”è¾ƒæ–°æ—§å€¼ã€‚
- ğŸ“Œ è°ƒç”¨`this.setState()` é€šå¸¸ä¸ä¼šè§¦å‘ `getDerivedStateFromProps()`ã€‚

- ğŸ“Œ è¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œæ‰€ä»¥å‡½æ•°ä½“å†…ä¸èƒ½è®¿é—® thisï¼›
- åœ¨ç»„ä»¶è£…è½½å’Œæ›´æ–°é˜¶æ®µéƒ½ä¼šè¢«è°ƒç”¨ï¼›

ğŸŒ° **ç¤ºä¾‹ï¼š**

```js
static getDerivedStateFromProps(nextProps, prevState) {
  if (nextProps.translateX !== prevState.translateX) {
    return {
      translateX: nextProps.translateX
    }
  }
  return null;
}
```

> ğŸ’¡ å¯ç”¨äºè£…è½½é˜¶æ®µï¼ˆMountingï¼‰å’Œæ›´æ–°é˜¶æ®µï¼ˆUpdatingï¼‰
>
> ğŸ‰ å…¸å‹åœºæ™¯ï¼šè¡¨å•è·å–é»˜è®¤å€¼

#### UNSAFE_componentWillMount

**é¢„è£…è½½å‡½æ•°**ã€‚åœ¨è£…è½½ç»„ä»¶å‘ç”Ÿå‰è¢«è°ƒç”¨ï¼Œå…¶åœ¨æ¸²æŸ“ `render()` ä¹‹å‰è¢«è°ƒç”¨ã€‚

ğŸ“Œ `componentWillMount` æ–¹æ³•çš„è°ƒç”¨åœ¨ `constructor` ä¹‹åï¼Œåœ¨ `render` ä¹‹å‰ï¼Œå› æ­¤åœ¨æ­¤ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡ŒåŒæ­¥åœ°è®¾ç½®ç»„ä»¶å†…éƒ¨çŠ¶æ€ `setState` å°†ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚

é¿å…åœ¨è¯¥æ–¹æ³•ä¸­å¼•å…¥ä»»ä½•çš„å‰¯ä½œç”¨æˆ–è®¢é˜…ã€‚å¯¹äºè¿™äº›ä½¿ç”¨åœºæ™¯ï¼Œæ¨èä½¿ç”¨ `constructor()` æ¥æ›¿ä»£ã€‚

> ğŸ’¡åœ¨è¯¥é’©å­å‡½æ•°ä¸­å¤„ç†çš„æ“ä½œï¼Œå»ºè®®æå‰åˆ°æ„é€ å‡½æ•°ä¸­ã€‚
>
> ğŸ—‘æ­¤ç”Ÿå‘½å‘¨æœŸå‡½æ•°å°†åœ¨React v17æ­£å¼åºŸå¼ƒã€‚

#### render

**æ¸²æŸ“å‡½æ•°**ã€‚å”¯ä¸€çš„ä¸€å®šä¸èƒ½çœç•¥çš„å‡½æ•°ï¼Œè€Œä¸”å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè¿”å› null æˆ– false è¡¨ç¤ºä¸æ¸²æŸ“ä»»ä½• DOM å…ƒç´ ã€‚

å½“è¢«è°ƒç”¨æ—¶ï¼Œå…¶åº”è¯¥æ£€æŸ¥ `this.props` å’Œ `this.state` å¹¶è¿”å›ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š

- **Reactå…ƒç´ **ã€‚é€šå¸¸æ˜¯ç”± JSX åˆ›å»ºã€‚è¯¥å…ƒç´ å¯èƒ½æ˜¯ä¸€ä¸ªåŸç”ŸDOMç»„ä»¶çš„è¡¨ç¤ºï¼Œå¦‚`<div />`ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªä½ å®šä¹‰çš„åˆæˆç»„ä»¶ã€‚
- **æ•°ç»„å’Œç‰‡æ®µ**ã€‚è®©ä½ è¿”å›å¤šä¸ªå…ƒç´ çš„ç‰‡æ®µï¼ˆFragmentï¼‰ã€‚
- **å­—ç¬¦ä¸²å’Œæ•°å­—**ã€‚è¿™äº›å°†è¢«æ¸²æŸ“ä¸º DOM ä¸­çš„ text nodeã€‚
- **Protals**ã€‚ç”±Â [`ReactDOM.createPortal`](http://react.yubolun.com/docs/portals.html)Â åˆ›å»ºã€‚
- **å¸ƒå°”å€¼å’Œ `null`**ã€‚ä»€ä¹ˆéƒ½ä¸æ¸²æŸ“ï¼ˆé€šå¸¸å­˜åœ¨äºÂ  `return test && <Child />` å†™æ³•ï¼Œå…¶ä¸­Â `test`Â æ˜¯å¸ƒå°”å€¼ã€‚ï¼‰

å®ƒæ˜¯ä¸€ä¸ªä»…ä»…ç”¨äºæ¸²æŸ“çš„**çº¯å‡½æ•°**ï¼Œè¿”å›å€¼å®Œå…¨å–å†³äº State å’Œ Propsï¼Œä¸èƒ½åœ¨å‡½æ•°ä¸­ä»»ä½•ä¿®æ”¹ Propsã€Stateã€è¯·æ±‚æ•°æ®ç­‰å…·æœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œä¸è¯»å†™ DOM ä¿¡æ¯ï¼Œä¹Ÿä¸å’Œæµè§ˆå™¨äº¤äº’ï¼ˆä¾‹å¦‚ `setTimeout`ï¼‰ã€‚å¦‚æœéœ€è¦å’Œæµè§ˆå™¨äº¤äº’ï¼Œåœ¨ `componentDidMount()` ä¸­æˆ–è€…å…¶å®ƒç”Ÿå‘½å‘¨æœŸæ–¹æ³•å®Œæˆç›¸å…³äº‹åŠ¡ã€‚

ğŸ“Œ æ­¤æ¸²æŸ“å‡½æ•°å¹¶ä¸åšå®é™…çš„æ¸²æŸ“åŠ¨ä½œï¼ˆæ¸²æŸ“åˆ° DOM æ ‘ï¼‰ï¼Œå®ƒè¿”å›çš„åªæ˜¯ä¸€ä¸ª JSX çš„æè¿°å¯¹è±¡ï¼ˆåŠç»„ä»¶å®ä¾‹ï¼‰ï¼Œä½•æ—¶è¿›è¡ŒçœŸæ­£çš„æ¸²æŸ“æ˜¯æœ‰ React åº“å†³å®šçš„ã€‚è€Œ React è‚¯å®šæ˜¯è¦æŠŠæ‰€æœ‰ç»„ä»¶è¿”å›çš„ç»“æœç»¼åˆèµ·æ¥ï¼Œæ‰èƒ½çŸ¥é“å¦‚ä½•äº§ç”ŸçœŸå®çš„ DOM æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ React åº“è°ƒç”¨æ‰€æœ‰ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ä¹‹åï¼Œæ‰æœ‰å¯èƒ½å®Œæˆ DOM è£…è½½ï¼Œè¿™æ—¶å€™æ‰ä¼šä¾æ¬¡è°ƒç”¨ `componentDidMount` å‡½æ•°ä½œä¸ºè£…è½½çš„æ”¶å°¾ã€‚

ä¿æŒ `render()` çº¯ç²¹ï¼Œå¯ä»¥ä½¿æœåŠ¡å™¨ç«¯æ¸²æŸ“æ›´åŠ åˆ‡å®å¯è¡Œï¼Œä¹Ÿä½¿ç»„ä»¶æ›´å®¹æ˜“è¢«ç†è§£ã€‚

> âš ï¸è¯·å‹¿åœ¨æ­¤å‡½æ•°ä¸­ä½¿ç”¨ `setState` æ–¹æ³•ã€‚

#### componentDidMount

**æŒ‚è½½æˆåŠŸå‡½æ•°**ã€‚ç»„ä»¶å®Œå…¨æŒ‚è½½åˆ°ç½‘é¡µä¸Šæ—¶è°ƒç”¨ã€‚

> ğŸ”¬è¯¥å‡½æ•°ä¸ä¼šåœ¨ `render` å‡½æ•°è°ƒç”¨å®Œæˆä¹‹åç«‹å³è°ƒç”¨ï¼Œå› ä¸º `render` å‡½æ•°ä»…ä»…æ˜¯è¿”å›äº† JSX çš„å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰ç«‹å³æŒ‚è½½åˆ° DOM æ ‘ä¸Šï¼Œè€Œ `componentDidMount` æ˜¯åœ¨**ç»„ä»¶è¢«æ¸²æŸ“åˆ° DOM æ ‘ï¼ˆç§°ä¸ºåˆå§‹åŒ–æ¸²æŸ“ï¼‰**ä¹‹åè¢«è°ƒç”¨çš„ã€‚å¦å¤–ï¼Œ`componentDidMount` å‡½æ•°åœ¨è¿›è¡ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ä¸ä¼šè¢«è°ƒç”¨ï¼ˆä»…å®¢æˆ·ç«¯æœ‰æ•ˆï¼‰ã€‚

`componentDidMount` é€šå¸¸ç”¨äºåŠ è½½å¤–éƒ¨æ•°æ®ï¼ˆå³å‘é€ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œä¹‹æ‰€ä»¥åœ¨ `componentDidMount` ä¸­è€Œä¸æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œæ•°æ®è¯·æ±‚çš„åŸå› åœ¨äºï¼šå¦‚æœæ•°æ®åŠ è½½å®Œæ¯•åï¼Œå³ Props å·²ç»æœ‰å€¼äº†ï¼Œä½†æ˜¯ç»„ä»¶è¿˜æ²¡æœ‰æ¸²æŸ“å‡ºæ¥ï¼Œä¼šæŠ¥é”™ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€äº›æŠŠæ•°æ®æ‹‰å–æå‰åˆ° `constructor` å‡½æ•°çš„æ€è·¯ï¼šåœ¨ `contructor` å‡½æ•°ä¸­ï¼Œé€šè¿‡ Promise æ¥è¿›è¡Œæ•°æ®çš„è¯·æ±‚ï¼Œå¹¶ä¸”ç»‘å®šåˆ°å½“å‰å®ä¾‹å¯¹è±¡ä¸Šï¼Œç„¶ååœ¨ `componentDidMount` ä¸­æ‰§è¡Œ Promise æŠŠæ•°æ®æ›´æ–°åˆ° props ä¸Šã€‚

åœ¨ç”Ÿå‘½å‘¨æœŸä¸­çš„è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œç»„ä»¶æ‹¥æœ‰ä¸€ä¸ª DOM å±•ç°ï¼Œä½ å¯ä»¥é€šè¿‡ `this.getDOMNode()` æ¥è·å–ç›¸åº” DOM èŠ‚ç‚¹ã€‚é€‚ç”¨äº**éœ€è¦åˆå§‹åŒ– DOM èŠ‚ç‚¹çš„æ“ä½œ**ã€‚

å¦‚æœæƒ³å’Œå…¶å®ƒ JavaScript æ¡†æ¶é›†æˆï¼Œä½¿ç”¨ `setTimeout` æˆ–è€… `setInterval` æ¥è®¾ç½®å®šæ—¶å™¨ï¼Œæˆ–è€…å‘é€ AJAX è¯·æ±‚ï¼Œå¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­æ‰§è¡Œè¿™äº›æ“ä½œã€‚é€‚ç”¨äº **AJAX è¯·æ±‚**ã€‚

> ğŸ“‹é€‚ç”¨åœºæ™¯ï¼šå‘é€ç½‘ç»œè¯·æ±‚ï¼›åˆå§‹åŒ– DOM èŠ‚ç‚¹æ“ä½œï¼›æ·»åŠ äº‹ä»¶ç›‘å¬ã€‚

### æ›´æ–°é˜¶æ®µ Updating

å±æ€§ï¼ˆPropsï¼‰æˆ–çŠ¶æ€ï¼ˆStateï¼‰çš„æ”¹å˜ä¼šè§¦å‘ä¸€æ¬¡æ›´æ–°ã€‚å½“ä¸€ä¸ªç»„ä»¶åœ¨è¢«é‡æ–°æ¸²æŸ“æ—¶ï¼Œè¿™äº›æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ã€‚

#### UNSAFE_componentWillReceiveProps(nextProps)

> âš ï¸ æ¨èä½¿ç”¨ `getDerivedStateProps()` ç”Ÿå‘½å‘¨æœŸã€‚

- å³ä¾¿ Props æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¯¥å‡½æ•°äº¦æœ‰æœºä¼šè¢«è°ƒç”¨ï¼›
- åœ¨ç»„ä»¶æ›´æ–°ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œ**åªè¦**çˆ¶ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ï¼ˆrenderï¼‰è¢«è°ƒç”¨ï¼Œåœ¨æ¸²æŸ“å‡½æ•°é‡Œè¢«æ¸²æŸ“çš„å­ç»„ä»¶å°±ä¼šç»å†æ›´æ–°è¿‡ç¨‹ï¼Œä¸ç®¡çˆ¶ç»„ä»¶ä¼ ç»™å­ç»„ä»¶çš„ Props æœ‰æ²¡æœ‰æ”¹å˜ï¼Œéƒ½ä¼šè§¦å‘å­ç»„ä»¶çš„ `componentWillReceiveProps` å‡½æ•°ï¼›
- ğŸ’¡é€šè¿‡ `this.setState()` æ–¹æ³•è§¦å‘çš„æ›´æ–°è¿‡ç¨‹ä¸ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼›
- å› ä¸ºï¼Œè¿™ä¸ªå‡½æ•°é€‚åˆæ ¹æ®æ–°çš„ Props å€¼ï¼ˆä¹Ÿå°±æ˜¯å‚æ•° `nextProps`ï¼‰æ¥è®¡ç®—æ˜¯ä¸æ˜¯è¦æ›´æ–°å†…éƒ¨çŠ¶æ€ Stateï¼›è€Œæ›´æ–°å†…éƒ¨çŠ¶æ€ State çš„æ–¹æ³•æ˜¯ `this.setState()` ï¼Œå¦‚æœ `this.setState()` çš„è°ƒç”¨å¯¼è‡´ `componentWillReceiveProps` å†è°ƒç”¨ï¼Œé‚£å°†æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ã€‚

é€šè¿‡ `this.props` å–å¾—å½“å‰çš„ Propsï¼ŒnextProps ä¼ å…¥çš„æ˜¯è¦æ›´æ–°çš„ Propsã€‚æ‰€ä»¥ä½¿ç”¨æ­¤æ–¹æ³•è¦ç¡®ä¿æ¯”è¾ƒ `this.props` å’Œ `nextProps`ï¼ŒåŸºäºå¯¹æ¯”çš„ç»“æœå»å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥åŸºäºæ–°çš„å±æ€§æ¥è®¾ç½®ç»„ä»¶çš„çŠ¶æ€ã€‚

ç”¨æ­¤å‡½æ•°å¯ä»¥ä½œä¸º React åœ¨ Props ä¼ å…¥ä¹‹åï¼Œ `render()` æ¸²æŸ“ä¹‹å‰æ›´æ–° State çš„æœºä¼šã€‚åœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨ `this.setState()` å°†ä¼šå¼•èµ·ç¬¬äºŒæ¬¡æ¸²æŸ“ã€‚

> ğŸ‰ é€‚ç”¨åœºæ™¯ï¼šæ›´æ–° state çš„å€¼ï¼ˆæ¯”å¦‚é‡ç½®ï¼‰ï¼›æ¯”è¾ƒ this.props å’Œ nextProps
>
> ğŸ—‘ æ­¤ç”Ÿå‘½å‘¨æœŸå‡½æ•°å°†åœ¨React v17æ­£å¼åºŸå¼ƒã€‚
>
> âš ï¸ æ¨èä½¿ç”¨ `static getDerivedStateFromProps()` ä»£æ›¿ã€‚

#### shouldComponentUpdate(nextProps, nextState)

æ¯æ¬¡ç»„ä»¶å› ä¸º State å’Œ Props å˜åŒ–è€Œæ›´æ–°æ—¶ï¼Œåœ¨**é‡æ–°æ¸²æŸ“å‰**è¯¥ç”Ÿå‘½å‘¨æœŸå‡½æ•°éƒ½ä¼šè°ƒç”¨ï¼Œè®© React çŸ¥é“å½“å‰ State æˆ– Props çš„æ”¹å˜æ˜¯å¦å½±å“ç»„ä»¶çš„è¾“å‡ºã€‚åœ¨ä¸€ä¸ªæ›´æ–°ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œç»„ä»¶åŠå…¶å­ç»„ä»¶å°†æ ¹æ®è¯¥æ–¹æ³•è¿”å›çš„å¸ƒå°”å€¼æ¥å†³å®šæ˜¯å¦ç»§ç»­è¿™æ¬¡æ›´æ–°è¿‡ç¨‹ï¼ˆé‡æ–°æ¸²æŸ“ï¼‰ã€‚è¿™æ ·ä½ å¯ä»¥åœ¨å¿…è¦çš„æ—¶å€™é˜»æ­¢ç»„ä»¶çš„æ¸²æŸ“ç”Ÿå‘½å‘¨æœŸï¼ˆRender Lifecycleï¼‰æ–¹æ³•ï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚é»˜è®¤è¡Œä¸ºæ˜¯åœ¨æ¯ä¸€æ¬¡ State çš„æ”¹å˜é‡æ–°æ¸²æŸ“ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ åº”è¯¥ä¾èµ–äºé»˜è®¤è¡Œä¸ºã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•é»˜è®¤è¿”å› `true`ï¼Œè¡¨ç¤ºéœ€è¦é‡æ–°æ¸²æŸ“ã€‚åœ¨ State æ”¹å˜çš„æ—¶å€™é¿å…ç»†å¾®çš„ Bugï¼Œä½†æ˜¯å¦‚æœæ€»æ˜¯å°å¿ƒåœ°æŠŠ State å½“åšä¸å¯å˜çš„ï¼Œåœ¨ `render()` ä¸­åªä» Props å’Œ State è¯»å–å€¼ï¼Œæ­¤æ—¶ä½ å¯ä»¥è¦†ç›–è¯¥æ–¹æ³•ï¼Œå®ç°æ–°è€ Props å’Œ State çš„æ¯”å¯¹é€»è¾‘ã€‚

å½“è¯¥æ–¹æ³•è¿”å›çš„å¸ƒå°”å€¼ `false` å‘ŠçŸ¥ React æ— é¡»é‡æ–°æ¸²æŸ“æ—¶ï¼Œ`render`ã€`componentWillUpdate` å’Œ `componentDidUpdate` ç­‰ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨ã€‚

ğŸ’¡ å¦‚æœæ€§èƒ½æ˜¯ä¸ªç“¶é¢ˆï¼Œå°¤å…¶æ˜¯æœ‰å‡ åä¸ªç”šè‡³ä¸Šç™¾ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œä½¿ç”¨ `shouldComponentUpdate` å¯ä»¥ä¼˜åŒ–æ¸²æŸ“æ•ˆç‡ï¼Œæå‡åº”ç”¨çš„æ€§èƒ½ã€‚

> ğŸš« æ­¤é’©å­å‡½æ•°åœ¨åˆå§‹åŒ–æ¸²æŸ“å’Œä½¿ç”¨äº† forceUpdate æ–¹æ³•çš„æƒ…å†µä¸‹ä¸ä¼šè¢«è°ƒç”¨ã€‚
>
> âš ï¸ è¯·å‹¿åœ¨æ­¤å‡½æ•°ä¸­ä½¿ç”¨ setState æ–¹æ³•ï¼Œä¼šå¯¼è‡´å¾ªç¯è°ƒç”¨ã€‚
>
> ğŸˆrender å’Œ shouldComponentUpdate ä¹Ÿæ˜¯ React ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­å”¯äºŒä¸¤ä¸ªè¦æ±‚æœ‰è¿”å›ç»“æœçš„å‡½æ•°

#### UNSAFE_componentWillUpdate(nextProps, nextState)

**é¢„æ›´æ–°å‡½æ•°**ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªæ›´æ–°ç”Ÿå‘½å‘¨æœŸä¸­é‡æ–°æ¸²æŸ“æ‰§è¡Œä¹‹å‰çš„æœ€åä¸€ä¸ªæ–¹æ³•ã€‚ä½ å·²ç»æ‹¥æœ‰äº†ä¸‹ä¸€ä¸ªå±æ€§å’ŒçŠ¶æ€ï¼Œä»–ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä»»ç”±ä½ å¤„ç½®ã€‚ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•åœ¨æ¸²æŸ“ä¹‹å‰è¿›è¡Œæœ€åçš„å‡†å¤‡ã€‚

> ğŸ‰ é€‚ç”¨åœºæ™¯ï¼šæ ¹æ® State çš„ å˜åŒ–è®¾ç½®å˜é‡ï¼›æ´¾å‘äº‹ä»¶ï¼›å¼€å§‹åŠ¨ç”»ã€‚
>
> ğŸš« æ­¤é’©å­å‡½æ•°åœ¨åˆå§‹åŒ–æ¸²æŸ“çš„æ—¶å€™ä¸ä¼šè¢«è°ƒç”¨ã€‚
>
> âš ï¸ è¯·å‹¿åœ¨æ­¤å‡½æ•°ä¸­ä½¿ç”¨ `setState` æ–¹æ³•ï¼Œä¼šå¯¼è‡´å¾ªç¯è°ƒç”¨ã€‚å¦‚æœéœ€è¦åŸºäºæ–°çš„ Props è®¡ç®— Stateï¼Œå»ºè®®ä½¿ç”¨ `componentWillRreceiveProps`ã€‚ 
>
> ğŸ—‘ æ­¤ç”Ÿå‘½å‘¨æœŸå‡½æ•°å°†åœ¨React v17æ­£å¼åºŸå¼ƒã€‚

#### render

æ¸²æŸ“å‡½æ•°ã€‚

> âš ï¸è¯·å‹¿åœ¨æ­¤å‡½æ•°ä¸­ä½¿ç”¨ setState æ–¹æ³•ã€‚

#### getSnapshotBeforeUpdate()

`getSnapshotBeforeUpdate` ç”Ÿå‘½å‘¨æœŸæ¸²æŸ“å‡½æ•°æ‰§è¡Œåï¼Œå¹¶åœ¨å‡†å¤‡è¾“å‡ºå†™å…¥ DOM å‰è¢«è°ƒç”¨ï¼Œå®ƒèƒ½è®©ä½ æ•è·ä¸€äº›ä» DOM ä¸­æ‰èƒ½è·å–çš„ï¼ˆå¯èƒ½ä¼šå˜æ›´çš„ï¼‰ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œå…ƒç´ é‡æ–°æ¸²æŸ“åé¡µé¢å„ç§å®šä½ä½ç½®çš„å˜æ›´ç­‰ï¼‰ã€‚

æ­¤ç”Ÿå‘½å‘¨æœŸè¿”å›çš„ä»»ä½•å€¼å°†ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’ç»™ `componentDidUpdate`ã€‚ ï¼ˆè¿™ä¸ªç”Ÿå‘½å‘¨æœŸä¸æ˜¯ç»å¸¸éœ€è¦çš„ï¼Œä½†å¯ä»¥ç”¨äºåœ¨æ¢å¤æœŸé—´æ‰‹åŠ¨ä¿å­˜æ»šåŠ¨ä½ç½®çš„æƒ…å†µã€‚ï¼‰

âš ï¸ ä¸`componentDidUpdate`ä¸€èµ·ï¼Œè¿™ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸå°†è¦†ç›–æ—§ç‰ˆ `componentWillUpdate` çš„æ‰€æœ‰ç”¨ä¾‹ã€‚

```js
getSnapshotBeforeUpdate(prevProps, prevState) {
    console.log('#enter getSnapshotBeforeUpdate');
    return 'foo';
}

componentDidUpdate(prevProps, prevState, snapshot) {
    console.log('#enter componentDidUpdate snapshot = ', snapshot);
}
```

#### componentDidUpdate()

**æ›´æ–°å®Œæˆå‡½æ•°**ã€‚

é™¤äº†é¦–æ¬¡æ¸²æŸ“ä¹‹åè°ƒç”¨ `componentDidMount` ï¼Œå…¶ä»–æ¸²æŸ“ä¹‹åéƒ½æ˜¯è°ƒç”¨ `componentDidUpdate`ã€‚

ç›¸æ¯”è£…é…è¿‡ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ›´æ–°è¿‡ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä½¿ç”¨çš„ç›¸å¯¹æ¥è¯´è¦å°‘ä¸€äº›ã€‚å¸¸ç”¨çš„æ˜¯ getDerivedStateFromPropsã€componentShouldUpdateï¼Œå‰è€…ç»å¸¸ç”¨äºæ ¹æ®æ–° Props çš„æ•°æ®å»è®¾ç½®ç»„ä»¶çš„ Stateï¼Œè€Œåè€…åˆ™æ˜¯å¸¸ç”¨äºä¼˜åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚

> ğŸ‰ é€‚ç”¨åœºæ™¯ï¼šæ“ä½œ DOMï¼›å‘é€ç½‘ç»œè¯·æ±‚ã€‚
>
> ğŸš« æ­¤æ–¹æ³•ä¸ä¼šåœ¨åˆå§‹åŒ–æ¸²æŸ“çš„æ—¶å€™è°ƒç”¨ã€‚

### å¸è½½é˜¶æ®µ Unmounting

å½“ä¸€ä¸ªç»„ä»¶ä»DOMä¸­ç§»é™¤æ—¶ï¼Œè¯¥æ–¹æ³•è¢«è°ƒç”¨ã€‚

#### componentWillUnmount()

**é¢„å¸è½½å‡½æ•°**ã€‚åœ¨ç»„ä»¶å¸è½½å’Œé”€æ¯ä¹‹å‰è°ƒç”¨ã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•å»**æ‰§è¡Œä»»ä½•æ¸…ç†ä»»åŠ¡**ã€‚

å¸è½½è¿‡ç¨‹åªæ¶‰åŠä¸€ä¸ªå‡½æ•° `componentWillUnmount`ï¼Œå½“ç»„ä»¶è¦ä»DOMæ ‘ä¸Šåˆ é™¤å‰ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ç»å¸¸ç”¨äºå»é™¤ `componentDidMount` å‡½æ•°å¸¦æ¥çš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚æ¸…é™¤è®¡æ—¶å™¨ã€åˆ é™¤ `componentDidMount` ä¸­åˆ›é€ çš„é React å…ƒç´ ç­‰ã€‚

âš ï¸ åœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨ `setState` ä¸ä¼šè§¦å‘ `render`ï¼Œå› ä¸ºæ‰€æœ‰çš„æ›´æ–°é˜Ÿåˆ—ï¼Œæ›´æ–°çŠ¶æ€éƒ½è¢«é‡ç½®ä¸º `null`ã€‚

> ğŸ‰ é€‚ç”¨åœºæ™¯ï¼šåˆ é™¤ componentWillMount æˆ–å…¶å®ƒåœ°æ–¹æ·»åŠ çš„äº‹ä»¶ç›‘å¬ï¼›å–æ¶ˆç½‘ç»œè¯·æ±‚ï¼›å–æ¶ˆå®šæ—¶å™¨ï¼›è§£ç»‘ DOM äº‹ä»¶ã€‚
>
> âš ï¸ è¯·å‹¿åœ¨æ­¤å‡½æ•°ä¸­ä½¿ç”¨ setState æ–¹æ³•ã€‚

### æ•æ‰é”™è¯¯ Error Handling

åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶ä¼šè¢«è°ƒç”¨ã€‚

#### static getDerivedStateFromError(error)

è¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¼šåœ¨å­å­™ç»„ä»¶è·‘å‡ºé”™è¯¯æ—¶æ‰§è¡Œã€‚å®ƒæ¥æ”¶æŠ›å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°å¹¶ä¸”éœ€è¦è¿”å›å€¼ç”¨äºæ›´æ–° Stateã€‚

```jsx
class ErrorBoundary extends React.Component {
    constructor(props) {
        super(props)
        this.state = { hasError: false }
    }
    static getDerivedStatteFromError(){
        // Update state so the next render will show the fallback UI
        return { hasError: true }
    }
    render(){
        if (this.state.hasErro) {
            // You can render any custom fallback UI
            return <h1>Something went wwrong</h1>
        }
        
        return this.props.children
    }
}
```

#### componentDidCatch(error, info)

è¿™ä¸ªç”Ÿå‘½å‘¨æœŸä¼šåœ¨å­å­™ç»„ä»¶æŠ›å‡ºé”™è¯¯æ—¶è°ƒç”¨ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š

* `error` - æŠ›å‡ºçš„é”™è¯¯å¯¹è±¡
* `info` - åŒ…å«æœ‰å…³é”™è¯¯çš„ä¿¡æ¯çš„å¯¹è±¡

é”™è¯¯è¾¹ç•Œæ˜¯Reactç»„ä»¶ï¼Œå¹¶ä¸æ˜¯æŸåçš„ç»„ä»¶æ ‘ã€‚é”™è¯¯è¾¹ç•Œæ•æ‰å‘ç”Ÿåœ¨å­ç»„ä»¶æ ‘ä¸­ä»»æ„åœ°æ–¹çš„JavaScripté”™è¯¯ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—ï¼Œå¹¶ä¸”æ˜¾ç¤ºå›é€€çš„ç”¨æˆ·ç•Œé¢ã€‚é”™è¯¯è¾¹ç•Œæ•æ‰æ¸²æŸ“æœŸé—´ã€åœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­å’Œåœ¨å®ƒä»¬ä¹‹ä¸‹æ•´æ£µæ ‘çš„æ„é€ å‡½æ•°ä¸­çš„é”™è¯¯ã€‚

---

**å‚è€ƒèµ„æ–™ï¼š**

- [React V16.3å³å°†æ›´æ”¹çš„ç”Ÿå‘½å‘¨æœŸ](http://web.jobbole.com/94406/)